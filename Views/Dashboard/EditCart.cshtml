@model TicketAppMVC.Models.CartItemSession

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <h2>Edit Ticket</h2>

    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Event</th>
                <th>Price (R)</th>
                <th>Quantity</th>
                <th>Subtotal (R)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>@Model.EventTitle</td>
                <td>@Model.Price.ToString("0.00")</td>
                <td>
                    <div class="d-flex align-items-center gap-2">
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="changeQty(-1)">−</button>
                        <input id="qty" type="number" min="1" max="@Model.Quantity" value="@Model.Quantity"
                               class="form-control form-control-sm text-center" style="width:60px;" readonly>
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="changeQty(1)">+</button>
                    </div>
                </td>
                <td id="subtotal">@(@Model.Price * @Model.Quantity)</td>
            </tr>
        </tbody>
    </table>

    <form method="post" action="@Url.Action("EditCart", "Dashboard")">
        <input type="hidden" name="Id" value="@Model.TicketID" />
        <input type="hidden" id="postQty" name="Quantity" value="@Model.Quantity" />
        <button type="submit" class="btn btn-success">Save</button>
    </form>
</div>

@section scripts {
    <script>
        function changeQty(delta) {
            var qtyEl = document.getElementById('qty');
            var postEl = document.getElementById('postQty');
            var subtotalEl = document.getElementById('subtotal');
            var max = parseInt(qtyEl.getAttribute('max'));
            var min = parseInt(qtyEl.getAttribute('min'));
            var qty = parseInt(qtyEl.value) + delta;

            if (qty < min) qty = min;
            if (qty > max) qty = max;

            qtyEl.value = qty;
            postEl.value = qty;
            subtotalEl.innerText = (qty * @Model.Price).toFixed(2);
        }
    </script>
}
